Single cell RNA-Seq reads derived from differentiating B6xCast mouse ESC hybrids (day 0-5) were generated by the Fluidigm C1-HT protocol. It employs a dual barcoding strategy, where read R1 contains a custom barcode (position 1-6, cell barcode) and a unique molecular identifier (position 7-11), read R2 maps to the cDNA sequence and read R3 contains a Nextera (row) barcode. After demultiplexing using the Nextera barcode, read R2 was aligned with STAR (v.2.5.2b) to the mouse genome genome (mm10) and all 96 ERCC spike-in sequences, allowing for unique alignments with a maximum of two mismatches. SNPsplit (v.0.3.2) was used to N-mask the genome using high confidence SNPs. The Drop-seq pipeline (v.1.12) was used to extract both cell barcode and UMI from read R1 and to quantify gene expression. In detail, reads were demultiplexed using the cell barcode, and molecules per gene were counted as the number of unique exon-overlapping UMI barcodes using the mm10 Ensembl gene annotation.  For RNA velocity analyses unique UMI barcodes aligning only to exonic regions (spliced) or overlapping with intronic regions (unspliced) were used. For allele-specific (AS) quantification each read overlapping a SNP position was assigned to its parental genome using SNPsplit (v.0.3.2) and the number of unique UMI barcodes assigned to either parental genome were counted for each gene.

This folder stores all the BASH and R scripts used for single-cell read alignment and gene expression quantification. 

In order to perform these analyses, the following have to be installed and stored in the "alignment/scripts/" directory:
- Drop-seq (v.1.12) JAVA script from "https://github.com/broadinstitute/Drop-seq/"
- SNPsplit (v.0.3.2) PERL script from "https://www.bioinformatics.babraham.ac.uk/projects/SNPsplit/"
- STAR (v.2.5.2b) aligner from "https://github.com/alexdobin/STAR"
- R (v.3.6.1) software from "https://cran.r-project.org/"

R scripts can be run using R (v.3.6.1) software (available at "https://cran.r-project.org/"). The following R libraries are required:
- data.table (v.1.12.8)
- plyr (v.1.8.6)
- edgeR (v.3.26.8)

The alignemnt and gene counting analyses can be reproduced following the instruction described by the Sweave R scripts, stored in the "alignment/launch/" directory:
(i)   "1_MaskMouseGenome.Rnw": generation of the B6/Cast N-masked FASTA files and GTF annotations
(ii)  "2_HighOutput_AlignCount.Rnw": alignment of the FASTQ files (time points: d0-d4) generated in High Output mode, and single-cell gene expression quantification 
(iii) "3_RapidRun_AlignCount.Rnw": alignment of the FASTQ files (time points: d1) generated in Rapid Run mode, and single-cell gene expression quantification 
(iv)  "4_CountMatrices.Rnw": combination of single cell count matrices (generated by (ii) and (iii)) for all cells and time points

The above .Rnw scripts use the BASH and R scripts stored in the "alignment/scripts/" folder, and store the resulting allele specific (AS) and not-AS count matrices (exon-overlapping, spliced and unspliced) in the "alignment/Count_Matrices/" output directory. Finally, the "alignment/mm10/" folder includes some files necessary to run (i), and the GTF files for the intronic ("intron.gtf.gz") and exonic&intronic ("wholegene.gtf.gz") annotation files which require long computational time if the (i) script is not parallelized.
